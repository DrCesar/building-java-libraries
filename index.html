<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.3">
<meta name="author" content="Chris Beams, Schalk Cronjé">
<title>Building Java Libraries</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css">
<link rel="stylesheet" href="./coderay-asciidoctor.css">
<link rel="stylesheet" href="https://guides.gradle.org/asciidoctor.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,400,700|Source+Code+Pro:500">
<link rel="apple-touch-icon" sizes="180x180" href="https://guides.gradle.org/icon/apple-touch-icon.png">
<link rel="icon" type="image/png" href="https://guides.gradle.org/icon/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="https://guides.gradle.org/icon/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="https://guides.gradle.org/icon/manifest.json">
<link rel="mask-icon" href="https://guides.gradle.org/icon/safari-pinned-tab.svg" color="#5bbad5">
<link rel="shortcut icon" href="https://guides.gradle.org/icon/favicon.ico">
<meta name="apple-mobile-web-app-title" content="Building Groovy Libraries">
<meta name="application-name" content="Building Groovy Libraries">
<meta name="msapplication-config" content="https://guides.gradle.org/icon/browserconfig.xml">
<meta name="theme-color" content="#ffffff">
<script defer src="https://guides.gradle.org/js/set-time-to-complete-text.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i["GoogleAnalyticsObject"]=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,"script","https://www.google-analytics.com/analytics.js","ga");
  ga("create", "UA-4207603-1", "auto");
  ga("send", "pageview");
</script>
</head>
<body class="article toc2 toc-right">
<div id="header"><div style="padding-top: 10px;"><a href="https://guides.gradle.org"><img src="http://guides.gradle.org/gradle-guides.svg" alt=""></a></div><h1>Building Java Libraries</h1>
<div class="details">
<span id="author" class="author">Chris Beams, Schalk Cronjé</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#what_you_ll_build">What you’ll build</a></li>
<li><a href="#what_you_ll_need">What you’ll need</a></li>
<li><a href="#create_a_library_project">Create a library project</a></li>
<li><a href="#run_the_init_task">Run the init task</a></li>
<li><a href="#review_the_generated_project_files">Review the generated project files</a></li>
<li><a href="#assemble_the_library_jar">Assemble the library JAR</a></li>
<li><a href="#customize_the_library_jar">Customize the library JAR</a></li>
<li><a href="#adding_api_documentation">Adding API documentation</a></li>
<li><a href="#summary">Summary</a></li>
<li><a href="#next_steps">Next steps</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This guide walks you through the process of using Gradle&#8217;s Build Init plugin to produce a JVM library which is suitable for consumption by other JVM libraries and applications.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="what_you_ll_build"><a class="anchor" href="#what_you_ll_build"></a>What you’ll build</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You&#8217;ll generate a Java library with the standard layout.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="what_you_ll_need"><a class="anchor" href="#what_you_ll_need"></a>What you’ll need</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>About <span class="time-to-complete-text"></span></p>
</li>
<li>
<p>A text editor or IDE</p>
</li>
<li>
<p>A <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Java Development Kit</a> (JDK), version 1.7 or better</p>
</li>
<li>
<p>A <a href="https://gradle.org/install">Gradle distribution</a>, version 3.5 or better</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="create_a_library_project"><a class="anchor" href="#create_a_library_project"></a>Create a library project</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Gradle comes with a built-in plugin called the Build Init plugin. It is documented in the <a href="https://docs.gradle.org/current/userguide/build_init_plugin.html">Gradle User Manual</a>. The plugin has one task, called <code>init</code>, that generates the project. The <code>init</code> task calls the (also built-in) <code>wrapper</code> task to create a Gradle wrapper script, <code>gradlew</code>.</p>
</div>
<div class="paragraph">
<p>The first step is to create a folder for the new project and change directory into it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mkdir building-java-libraries
$ cd building-java-libraries</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="run_the_init_task"><a class="anchor" href="#run_the_init_task"></a>Run the init task</h2>
<div class="sectionbody">
<div class="paragraph">
<p>From inside the new project directory, run the <code>init</code> task with the <code>java-library</code> argument.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle init --type java-library
:wrapper
:init

BUILD SUCCESSFUL</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>init</code> task runs the <code>wrapper</code> task first, which generates the <code>gradlew</code> and <code>gradlew.bat</code> wrapper scripts. Then it creates the new project with the following structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>.
├── build.gradle
├── gradle
│   └── wrapper <i class="conum" data-value="1"></i><b>(1)</b>
│       ├── gradle-wrapper.jar
│       └── gradle-wrapper.properties
├── gradlew
├── gradlew.bat
├── settings.gradle
└── src
    ├── main
    │   └── java <i class="conum" data-value="2"></i><b>(2)</b>
    │       └── Library.java
    └── test
        └── java <i class="conum" data-value="3"></i><b>(3)</b>
            └── LibraryTest.java</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Generated folder for wrapper files</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Default Java source folder</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Default Java test folder</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You now have the necessary components for a simple Java library project.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="review_the_generated_project_files"><a class="anchor" href="#review_the_generated_project_files"></a>Review the generated project files</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>settings.gradle</code> file is heavily commented, but has only one active line:</p>
</div>
<div class="listingblock">
<div class="title">Generated settings.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">rootProject.name=<span class="string"><span class="delimiter">'</span><span class="content">building-java-libraries</span><span class="delimiter">'</span></span> <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This assigns the name of the root project.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The generated <code>build.gradle</code> file also has many comments. The active portion is reproduced here (note version numbers for the dependencies may be updated in later versions of Gradle):</p>
</div>
<div class="listingblock">
<div class="title">Generated build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">java-library</span><span class="delimiter">'</span></span>

repositories {
    jcenter() <i class="conum" data-value="1"></i><b>(1)</b>
}

dependencies {
    api <span class="string"><span class="delimiter">'</span><span class="content">org.apache.commons:commons-math3:3.6.1</span><span class="delimiter">'</span></span> <i class="conum" data-value="2"></i><b>(2)</b>

    implementation <span class="string"><span class="delimiter">'</span><span class="content">com.google.guava:guava:21.0</span><span class="delimiter">'</span></span> <i class="conum" data-value="3"></i><b>(3)</b>

    testImplementation <span class="string"><span class="delimiter">'</span><span class="content">junit:junit:4.12</span><span class="delimiter">'</span></span> <i class="conum" data-value="4"></i><b>(4)</b>
}

version = <span class="string"><span class="delimiter">'</span><span class="content">0.1.0</span><span class="delimiter">'</span></span>

jar {
    manifest {
        attributes(<span class="string"><span class="delimiter">'</span><span class="content">Implementation-Title</span><span class="delimiter">'</span></span>: project.name,
                   <span class="string"><span class="delimiter">'</span><span class="content">Implementation-Version</span><span class="delimiter">'</span></span>: project.version)
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Public Bintray Artifactory repository</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This is an example of a dependency which is exported to consumers, that is to say found on their compile classpath.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>This is an exampe of a dependency which is used internally, and not exposed to consumers on their own compile classpath.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>JUnit testing library</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The build file adds the <a href="https://docs.gradle.org/3.5/userguide/java_library_plugin.html">java-library</a> plugin. This is an extension of the <code>java-base</code> plugin and adds additional tasks for compiling Java source code.</p>
</div>
<div class="paragraph">
<p>The file <code>src/main/java/Library.java</code> is shown here:</p>
</div>
<div class="listingblock">
<div class="title">Generated src/main/groovy/Library.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Library</span> {
    <span class="directive">public</span> <span class="type">boolean</span> someLibraryMethod() {
        <span class="keyword">return</span> <span class="predefined-constant">true</span>;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The generated JUnit specification, <code>src/test/java/LibraryTest.java</code> is shown next:</p>
</div>
<div class="listingblock">
<div class="title">Generated  src/test/java/LibraryTest.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.junit.Test</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">LibraryTest</span> {
    <span class="annotation">@Test</span> <span class="directive">public</span> <span class="type">void</span> testSomeLibraryMethod() {
        Library classUnderTest = <span class="keyword">new</span> Library();
        assertTrue(<span class="string"><span class="delimiter">&quot;</span><span class="content">someLibraryMethod should return 'true'</span><span class="delimiter">&quot;</span></span>, classUnderTest.someLibraryMethod());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The generated test class has a single <a href="http://junit.org/junit4/">JUnit 4</a> test. The test instantiates the <code>Library</code> class, invokes the <code>someLibraryMethod</code> method, and checks that the returned value is `true.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="assemble_the_library_jar"><a class="anchor" href="#assemble_the_library_jar"></a>Assemble the library JAR</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To build the project, run the <code>build</code> task. You can use the regular <code>gradle</code> command, but when a project includes a wrapper script, it is considered good form to use it instead.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ./gradlew build
:compileJava
:processResources NO-SOURCE
:classes
:jar
:assemble
:compileTestJava
:processTestResources NO-SOURCE
:testClasses
:test
:check
:build

BUILD SUCCESSFUL</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The first time you run the wrapper script, <code>gradlew</code>, there may be a delay while that version of <code>gradle</code> is downloaded and stored locally in your <code>~/.gradle/wrapper/dists</code> folder.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The first time you run the build, Gradle will check whether or not you already have the JUnit libraries and other listed dependencies in your cache under your <code>~/.gradle</code> directory. If not, the libraries will be downloaded and stored there. The next time you run the build, the cached versions will be used. The <code>build</code> task compiles the classes, runs the tests, and generates a test report.</p>
</div>
<div class="paragraph">
<p>You can view the test report by opening the HTML output file, located at <code>build/reports/tests/test/index.html</code>.</p>
</div>
<div class="paragraph">
<p>A sample report is shown here:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Test-Summary.png" alt="Test Summary">
</div>
</div>
<div class="paragraph">
<p>You can find your newly packaged JAR file in the <code>build/libs</code> directory with the name <code>building-java-libraries.jar</code>. Verify that the archive is valid by running the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ jar tf build/libs/building-java-libraries.jar
META-INF/
META-INF/MANIFEST.MF
Library.class</pre>
</div>
</div>
<div class="paragraph">
<p>You should see the required manifest file—<code>MANIFEST.MF</code>—and the compiled <code>Library</code> class.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>All of this happens without any additional configuration in <code>build.gradle</code> because Gradle&#8217;s <code>java-library</code> plugin assumes your project sources are arranged in a <a href="https://docs.gradle.org/3.5/userguide/java_plugin.html#sec:java_project_layout">conventional project layout</a>. You can customize the project layout if you wish <a href="https://docs.gradle.org/3.5/userguide/java_plugin.html#sec:changing_java_project_layout">as described in the user manual</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Congratulations, you have just completed the step from creating a Java library! You can can now customize this to your own project needs.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="customize_the_library_jar"><a class="anchor" href="#customize_the_library_jar"></a>Customize the library JAR</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You will often want the name of the JAR file to include the library <em>version</em>. This is easily achieved by setting a top-level <code>version</code> property in the build script, like so:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">version = <span class="string"><span class="delimiter">'</span><span class="content">0.1.0</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now run the <code>jar</code> task:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ./gradlew jar</pre>
</div>
</div>
<div class="paragraph">
<p>and notice that the resulting JAR file at <code>build/libs/building-java-libraries-0.1.0.jar</code> contains the version as expected.</p>
</div>
<div class="paragraph">
<p>Another common requirement is customizing the manifest file, typically by adding one or more attributes. Let&#8217;s include the library name and version in the manifest file by <a href="https://docs.gradle.org/3.5/userguide/more_about_tasks.html#sec:configuring_tasks">configuring the <code>jar</code> task</a>. Add the following to the end of your build script:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">jar {
    manifest {
        attributes(<span class="string"><span class="delimiter">'</span><span class="content">Implementation-Title</span><span class="delimiter">'</span></span>: project.name,
                   <span class="string"><span class="delimiter">'</span><span class="content">Implementation-Version</span><span class="delimiter">'</span></span>: project.version)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To confirm that these changes work as expected, run the <code>jar</code> task again, and this time also unpack the manifest file from the JAR:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ./gradlew jar
$ jar xf build/libs/building-java-libraries-0.1.0.jar META-INF/MANIFEST.MF</pre>
</div>
</div>
<div class="paragraph">
<p>Now view the contents of the <code>META-INF/MANIFEST.MF</code> file and you should see the following:</p>
</div>
<div class="listingblock">
<div class="title">META-INF/MANIFEST.MF</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="mf">Manifest-Version: 1.0
Implementation-Title: building-java-libraries
Implementation-Version: 0.1.0</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Learn more about configuring JARs</div>
<div class="paragraph">
<p>The <code>manifest</code> is just one of many properties that can be configured on the <code>jar</code> task. For a complete list, see the <a href="https://docs.gradle.org/3.5/dsl/org.gradle.api.tasks.bundling.Jar.html">Jar section</a> of the <a href="https://docs.gradle.org/3.5/dsl/">Gradle Language Reference</a> as well as the <a href="https://docs.gradle.org/3.5/userguide/java_plugin.html#sec:jar">Jar</a> and <a href="https://docs.gradle.org/3.5/userguide/working_with_files.html#sec:archives">Creating Archives</a> sections of the Gradle <a href="https://docs.gradle.org/3.5/userguide/userguide.html">User Manual</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now you can complete this exercise by trying to compile some Java code that uses the library you just built.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="adding_api_documentation"><a class="anchor" href="#adding_api_documentation"></a>Adding API documentation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>java-library</code> plugin has built-in support for Java&#8217;s API documentation tool via the <code>javadoc</code> task.</p>
</div>
<div class="paragraph">
<p>The code generated by the Build Init plugin already placed a comment on the <code>Library.java</code> file. Modify the comment to become <code>javadoc</code> markup.</p>
</div>
<div class="listingblock">
<div class="title">src/main/java/Library.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">/** This java source file was generated by the Gradle 'init' task.
 */</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Library</span> {
    <span class="directive">public</span> <span class="type">boolean</span> someLibraryMethod() {
        <span class="keyword">return</span> <span class="predefined-constant">true</span>;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run the <code>javadoc</code> task.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ ./gradlew javadoc

:compileJava
:processResources NO-SOURCE
:classes
:javadoc

BUILD SUCCESSFUL</pre>
</div>
</div>
<div class="paragraph">
<p>You can view the generated <code>javadoc</code> files by opening the HTML file located at <code>build/docs/javadoc/index.html</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="summary"><a class="anchor" href="#summary"></a>Summary</h2>
<div class="sectionbody">
<div class="paragraph">
<p>That&#8217;s it! You&#8217;ve now successfully built a Java library project, packaged it as a JAR and consumed it within a separate application. Along the way, you&#8217;ve learned how to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>How to generate a Java library</p>
</li>
<li>
<p>How the generated build file and sample Java files are structured</p>
</li>
<li>
<p>How to run the build and view the test report</p>
</li>
<li>
<p>Customize the name of a JAR file and the content of its manifest</p>
</li>
<li>
<p>Generating API documentation.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="next_steps"><a class="anchor" href="#next_steps"></a>Next steps</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Building a library is just one aspect of reusing code across project boundaries. From here, you may be interested in:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.gradle.org/3.5/userguide/artifact_dependencies_tutorial.html">Consuming JVM libraries</a></p>
</li>
<li>
<p><a href="https://docs.gradle.org/3.5/userguide/artifact_management.html">Publishing JVM libraries</a></p>
</li>
<li>
<p><a href="https://docs.gradle.org/3.5/userguide/intro_multi_project_builds.html">Working with multi-project builds</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2017-06-16 08:42:47 UTC
</div>
</div>
</body>
</html>